---
import Aside from '@/components/common/Aside.astro';
import BaseHead from '@/components/common/BaseHead.astro';
import Footer from '@/components/common/Footer.astro';
import Header from '@/components/common/Header.astro';
// import { ClientRouter } from 'astro:transitions'; // Keep commented out for 'static' unless using view transitions explicitly

interface Props {
  title: string;
  description: string;
  dim?: boolean;
  class?: string; // For the <main> element
}
const { title, description, dim: isDim, class: classList } = Astro.props;
---

<html lang="en">
  {/* Theme and font classes will be added by the head script */}

  <BaseHead {title} {description} />
  {/* <ClientRouter fallback="swap" /> */}

  {/* ===== Blocking Client-side Theme & Font Initialization Script ===== */}
  {/* This runs before the body renders to prevent FOUC */}
  <script is:inline>
    (function () {
      const d = document.documentElement;
      const t = localStorage.getItem('theme') || 'system';
      const f = localStorage.getItem('font') || 'serif';

      // Single batch class assignment
      d.className = `${t === 'dark' || (t === 'system' && matchMedia('(prefers-color-scheme:dark)').matches) ? 'dark' : ''} font-${f}`;
    })();
  </script>
  {/* ================================================================= */}

  <body class="flex flex-col items-center p-5 sm:p-12 lg:p-20 text-text/70 bg-bg">
    <Header />
    <div class="flex flex-wrap gap-20 w-full bg-bg">
      <Aside class="top-20 2xl:sticky" dim={isDim} transition:persist="aside" />
      <div class="flex-1 min-w-0 max-w-4xl">
        <main class:list={[classList]}>
          <slot />
        </main>
      </div>
    </div>
    <Footer />
  </body>
</html>
